<div class="container mt-4">
  <h4>üìä Danh s√°ch ƒëi·ªÉm</h4>

  <!-- B·ªô l·ªçc l·ªõp -->
  <div class="mb-3">
    <label for="classFilter" class="form-label fw-semibold">L·ªçc theo l·ªõp:</label>
    <select id="classFilter" class="form-select w-auto d-inline-block" [(ngModel)]="selectedClassCode" (change)="applyClassFilter()">
      <option value="">T·∫•t c·∫£</option>
      <option *ngFor="let c of availableClasses" [value]="c">{{ c }}</option>
    </select>
  </div>

  <div *ngIf="loading" class="text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <table *ngIf="!loading && filteredScores.length > 0" class="table table-bordered table-hover mt-3">
    <thead class="table-light">
      <tr>
        <th>M√£ SV</th>
        <th>H·ªç t√™n</th>
        <th>L·ªõp</th>
        <th>M√¥n h·ªçc</th>
        <th>GK</th>
        <th>CK</th>
        <th>Kh√°c</th>
        <th>T·ªïng</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of filteredScores">
        <td>{{ s.studentCode }}</td>
        <td>{{ s.studentName }}</td>
        <td>{{ s.classCode }}</td>
        <td>{{ s.subjectName }}</td>
        <td>{{ s.midterm ?? '-' }}</td>
        <td>{{ s.final ?? '-' }}</td>
        <td>{{ s.other ?? '-' }}</td>
        <td>{{ s.total }}</td>
        <td>
          <button class="btn btn-sm btn-primary" (click)="startEdit(s)">S·ª≠a</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && filteredScores.length === 0" class="alert alert-warning">
    Kh√¥ng c√≥ d·ªØ li·ªáu ƒëi·ªÉm cho l·ªõp n√†y.
  </div>

  <!-- Form ch·ªânh s·ª≠a ƒëi·ªÉm -->
  <div *ngIf="editingScore" class="card mt-4 p-3 border-primary">
    <h5>‚úèÔ∏è S·ª≠a ƒëi·ªÉm cho {{ editingScore.studentName }} ({{ editingScore.classCode }} - {{ editingScore.subjectName }})</h5>

    <div class="row g-3">
      <div class="col-md-4">
        <label>Gi·ªØa k·ª≥</label>
        <input type="number" class="form-control" [(ngModel)]="editingScore.midterm" />
      </div>
      <div class="col-md-4">
        <label>Cu·ªëi k·ª≥</label>
        <input type="number" class="form-control" [(ngModel)]="editingScore.final" />
      </div>
      <div class="col-md-4">
        <label>Kh√°c</label>
        <input type="number" class="form-control" [(ngModel)]="editingScore.other" />
      </div>
    </div>

    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-success" (click)="saveScore()">üíæ L∆∞u</button>
      <button class="btn btn-secondary" (click)="cancelEdit()">‚ùå H·ªßy</button>
    </div>
  </div>
</div>
