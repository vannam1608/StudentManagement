<div class="container mt-3">
  <h3>üìä Danh s√°ch ƒëi·ªÉm s·ªë</h3>

  <!-- TH√îNG B√ÅO -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <!-- THANH L·ªåC V√Ä T·∫†O ƒêI·ªÇM -->
  <div class="mb-3 d-flex flex-wrap align-items-center gap-2">
    <input [(ngModel)]="studentCode" class="form-control w-auto" placeholder="üîç M√£ SV..." />
    <input [(ngModel)]="classCode" class="form-control w-auto" placeholder="üè´ M√£ l·ªõp..." />

    <button class="btn btn-primary" (click)="filterScores()">L·ªçc</button>
    <button class="btn btn-success" (click)="autoCreateScores()">T·∫°o ƒëi·ªÉm t·ª± ƒë·ªông</button>
  </div>

  <!-- B·∫¢NG ƒêI·ªÇM (KH√îNG PH√ÇN THEO H·ªåC K·ª≤) -->
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>M√£ SV</th>
        <th>H·ªç t√™n</th>
        <th>M√¥n h·ªçc</th>
        <th>L·ªõp</th>
        <th>Gi·ªØa k·ª≥</th>
        <th>Cu·ªëi k·ª≥</th>
        <th>Kh√°c</th>
        <th>T·ªïng</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let score of scores">
        <td>{{ score.studentCode }}</td>
        <td>{{ score.fullName }}</td>
        <td>{{ score.subjectName }}</td>
        <td>{{ score.classCode }}</td>

        <!-- Gi·ªØa k·ª≥ -->
        <td>
          <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.midterm" class="form-control" />
          <span *ngIf="!editing[score.id]">{{ score.midterm ?? '-' }}</span>
        </td>

        <!-- Cu·ªëi k·ª≥ -->
        <td>
          <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.final" class="form-control" />
          <span *ngIf="!editing[score.id]">{{ score.final ?? '-' }}</span>
        </td>

        <!-- Kh√°c -->
        <td>
          <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.other" class="form-control" />
          <span *ngIf="!editing[score.id]">{{ score.other ?? '-' }}</span>
        </td>

        <!-- T·ªïng -->
        <td>{{ score.total }}</td>

        <!-- Thao t√°c -->
        <td>
          <button *ngIf="!editing[score.id]" class="btn btn-sm btn-primary" (click)="edit(score)">S·ª≠a</button>
          <button *ngIf="editing[score.id]" class="btn btn-sm btn-success" (click)="save(score)">L∆∞u</button>
          <button *ngIf="editing[score.id]" class="btn btn-sm btn-secondary" (click)="cancel(score.id)">H·ªßy</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- PH√ÇN TRANG -->
  <nav *ngIf="totalPages > 1" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="previousPage()">Tr∆∞·ªõc</button>
      </li>
      <li
        class="page-item"
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="i + 1 === currentPage"
      >
        <button class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="nextPage()">Sau</button>
      </li>
    </ul>
  </nav>
</div>
