<div class="container mt-3">
  <h3>ğŸ“Š Danh sÃ¡ch Ä‘iá»ƒm sá»‘ theo há»c ká»³</h3>

  <!-- THÃ”NG BÃO -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <!-- THANH CÃ”NG Cá»¤ -->
  <div class="mb-3 d-flex flex-wrap align-items-center gap-2">
    <input [(ngModel)]="studentCode" class="form-control w-auto" placeholder="ğŸ” Nháº­p mÃ£ SV..." />
    <button class="btn btn-info" (click)="filterByStudent()">ğŸ“ Lá»c theo sinh viÃªn</button>
    <button class="btn btn-success" (click)="autoCreateScores()">âš™ï¸ Táº¡o Ä‘iá»ƒm tá»± Ä‘á»™ng</button>
    <button class="btn btn-secondary" (click)="resetFilter()">ğŸ”„ Xem táº¥t cáº£</button>
  </div>

  <!-- DANH SÃCH ÄIá»‚M THEO Há»ŒC Ká»² -->
  <div *ngFor="let semester of groupedScores | keyvalue">
    <h5 class="mt-4 text-primary">ğŸ“˜ {{ semester.key }}</h5>

    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>MÃ£ SV</th>
          <th>MÃ´n há»c</th>
          <th>Lá»›p</th>
          <th>Giá»¯a ká»³</th>
          <th>Cuá»‘i ká»³</th>
          <th>KhÃ¡c</th>
          <th>Tá»•ng</th>
          <th>Thao tÃ¡c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let score of semester.value">
          <td>{{ score.studentCode }}</td>
          <td>{{ score.subjectName }}</td>
          <td>{{ score.classCode }}</td>

          <!-- Giá»¯a ká»³ -->
          <td>
            <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.midterm" class="form-control" />
            <span *ngIf="!editing[score.id]">{{ score.midterm ?? '-' }}</span>
          </td>

          <!-- Cuá»‘i ká»³ -->
          <td>
            <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.final" class="form-control" />
            <span *ngIf="!editing[score.id]">{{ score.final ?? '-' }}</span>
          </td>

          <!-- Äiá»ƒm khÃ¡c -->
          <td>
            <input *ngIf="editing[score.id]" type="number" [(ngModel)]="score.other" class="form-control" />
            <span *ngIf="!editing[score.id]">{{ score.other ?? '-' }}</span>
          </td>

          <!-- Tá»•ng -->
          <td>{{ score.total }}</td>

          <!-- Thao tÃ¡c -->
          <td>
            <button *ngIf="!editing[score.id]" class="btn btn-sm btn-primary" (click)="edit(score)">Sá»­a</button>
            <button *ngIf="editing[score.id]" class="btn btn-sm btn-success" (click)="save(score)">LÆ°u</button>
            <button *ngIf="editing[score.id]" class="btn btn-sm btn-secondary" (click)="cancel(score.id)">Há»§y</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
