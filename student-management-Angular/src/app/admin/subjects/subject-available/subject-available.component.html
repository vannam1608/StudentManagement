<div class="container mt-4">
  <h3 class="mb-3">ğŸ“š ÄÄƒng kÃ½ mÃ´n há»c theo há»c ká»³</h3>
  <button class="btn btn-secondary mb-3" (click)="goBack()">â† Quay láº¡i</button>

  <!-- Chá»n há»c ká»³ -->
  <div class="mb-3">
    <label for="semesterSelect" class="form-label">Chá»n há»c ká»³:</label>
    <select class="form-select" id="semesterSelect"
            [(ngModel)]="selectedSemesterId"
            (change)="onStudentOrSemesterChange()">
      <option *ngFor="let semester of semesters" [value]="semester.id">
        {{ semester.name }}
      </option>
    </select>
  </div>

  <!-- TÃ¬m kiáº¿m sinh viÃªn -->
  <div class="mb-3">
    <label for="studentSearch" class="form-label">TÃ¬m kiáº¿m sinh viÃªn:</label>
    <input type="text" 
           class="form-control" 
           id="studentSearch"
           placeholder="Nháº­p mÃ£ sinh viÃªn hoáº·c tÃªn sinh viÃªn..."
           [(ngModel)]="studentSearchTerm"
           (input)="onSearchStudent()">
  </div>

  <!-- Chá»n sinh viÃªn -->
  <div class="mb-3">
    <label for="studentSelect" class="form-label">Chá»n sinh viÃªn:</label>
    <select class="form-select" id="studentSelect"
            [(ngModel)]="selectedStudentId"
            (change)="onStudentOrSemesterChange()">
      <option *ngFor="let student of filteredStudents" [value]="student.id">
        {{ student.fullName }} ({{ student.studentCode }})
      </option>
    </select>
    <div *ngIf="filteredStudents.length === 0 && studentSearchTerm" class="text-muted mt-1">
      KhÃ´ng tÃ¬m tháº¥y sinh viÃªn nÃ o phÃ¹ há»£p.
    </div>
  </div>

  <!-- ThÃ´ng bÃ¡o -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- MÃ´n há»c kháº£ dá»¥ng -->
  <h5 class="mt-4">ğŸ“– MÃ´n há»c kháº£ dá»¥ng</h5>
  <table class="table table-bordered table-hover" *ngIf="(availableSubjects?.length || 0) > 0">
    <thead class="table-light">
      <tr>
        <th>MÃ£ mÃ´n</th>
        <th>TÃªn mÃ´n</th>
        <th>TÃ­n chá»‰</th>
        <th>MÃ´ táº£</th>
        <th>HÃ nh Ä‘á»™ng</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let subject of availableSubjects">
        <td>{{ subject.subjectCode }}</td>
        <td>{{ subject.name }}</td>
        <td>{{ subject.credit }}</td>
        <td>{{ subject.description }}</td>
        <td>
          <ng-container *ngIf="isSemesterOpen(); else disabledTemplate">
            <button class="btn btn-primary btn-sm"
                    (click)="registerSubject(subject.id)"
                    title="ÄÄƒng kÃ½ mÃ´n há»c">
              ÄÄƒng kÃ½
            </button>
          </ng-container>
          <ng-template #disabledTemplate>
            <button class="btn btn-secondary btn-sm" disabled>
              Há»c ká»³ Ä‘Ã£ Ä‘Ã³ng
            </button>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="availableSubjects?.length === 0" class="alert alert-warning">
    KhÃ´ng cÃ³ mÃ´n há»c kháº£ dá»¥ng cho há»c ká»³ nÃ y.
  </div>

  <!-- MÃ´n há»c Ä‘Ã£ Ä‘Äƒng kÃ½ -->
  <h5 class="mt-5">âœ… Danh sÃ¡ch mÃ´n há»c Ä‘Ã£ Ä‘Äƒng kÃ½</h5>
  <table class="table table-bordered table-striped" *ngIf="(enrolledSubjects?.length || 0) > 0">
    <thead class="table-dark">
      <tr>
        <th>MÃ£ mÃ´n</th>
        <th>TÃªn mÃ´n</th>
        <th>Há»c ká»³</th>
        <th>Lá»›p</th>
        <th>NgÃ y Ä‘Äƒng kÃ½</th>
        <th>HÃ nh Ä‘á»™ng</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let enrolled of enrolledSubjects">
        <td>{{ enrolled.subjectCode }}</td>
        <td>{{ enrolled.subjectName }}</td>
        <td>{{ enrolled.semesterName }}</td>
        <td>{{ enrolled.classCode }}</td>
        <td>{{ enrolled.enrollDate | date: 'dd/MM/yyyy' }}</td>
        <td>
          <button class="btn btn-danger btn-sm"
                  (click)="cancelEnrollment(enrolled.id)"
                  [disabled]="!isSemesterOpen()"
                  title="Há»§y Ä‘Äƒng kÃ½ mÃ´n há»c">
            Há»§y
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="enrolledSubjects?.length === 0" class="alert alert-info">
    ChÆ°a cÃ³ mÃ´n há»c nÃ o Ä‘Æ°á»£c Ä‘Äƒng kÃ½.
  </div>
</div>
