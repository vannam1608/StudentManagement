<div class="container mt-4">
  <h3 class="mb-3">ğŸ“š ÄÄƒng kÃ½ mÃ´n há»c theo há»c ká»³</h3>
  <button class="btn btn-secondary mb-3" (click)="goBack()">â† Quay láº¡i</button>

  <!-- Chá»n há»c ká»³ -->
  <div class="mb-3">
    <label for="semesterSelect" class="form-label">Chá»n há»c ká»³:</label>
    <select class="form-select" id="semesterSelect"
            [(ngModel)]="selectedSemesterId"
            (change)="onStudentOrSemesterChange()">
      <option *ngFor="let s of semesters" [value]="s.id">{{ s.name }}</option>
    </select>
  </div>

  <!-- Chá»n sinh viÃªn -->
  <div class="mb-3">
    <label for="studentSelect" class="form-label">Chá»n sinh viÃªn:</label>
    <select class="form-select" id="studentSelect"
            [(ngModel)]="selectedStudentId"
            (change)="onStudentOrSemesterChange()">
      <option *ngFor="let s of students" [value]="s.id">{{ s.fullName }} ({{ s.studentCode }})</option>
    </select>
  </div>

  <!-- ThÃ´ng bÃ¡o -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <!-- MÃ´n há»c kháº£ dá»¥ng -->
  <h5 class="mt-4">ğŸ“– MÃ´n há»c kháº£ dá»¥ng</h5>
  <table class="table table-bordered table-hover" *ngIf="availableSubjects.length > 0">
    <thead class="table-light">
      <tr>
        <th>MÃ£ mÃ´n</th>
        <th>TÃªn mÃ´n</th>
        <th>TÃ­n chá»‰</th>
        <th>MÃ´ táº£</th>
        <th>HÃ nh Ä‘á»™ng</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of availableSubjects">
        <td>{{ s.subjectCode }}</td>
        <td>{{ s.name }}</td>
        <td>{{ s.credit }}</td>
        <td>{{ s.description }}</td>
        <td>
          <ng-container *ngIf="isSemesterOpen(); else disabledButton">
            <button class="btn btn-primary btn-sm"
                    (click)="registerSubject(s.id)"
                    title="ÄÄƒng kÃ½ mÃ´n há»c">
              ÄÄƒng kÃ½
            </button>
          </ng-container>
          <ng-template #disabledButton>
            <button class="btn btn-secondary btn-sm" disabled>Há»c ká»³ Ä‘Ã£ Ä‘Ã³ng</button>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="availableSubjects.length === 0" class="alert alert-warning">
    KhÃ´ng cÃ³ mÃ´n há»c kháº£ dá»¥ng cho há»c ká»³ nÃ y.
  </div>

  <!-- MÃ´n há»c Ä‘Ã£ Ä‘Äƒng kÃ½ -->
  <h5 class="mt-5">âœ… Danh sÃ¡ch mÃ´n há»c Ä‘Ã£ Ä‘Äƒng kÃ½</h5>
  <table class="table table-bordered table-striped" *ngIf="enrolledSubjects.length > 0">
    <thead class="table-dark">
      <tr>
        <th>MÃ£ mÃ´n</th>
        <th>TÃªn mÃ´n</th>
        <th>Há»c ká»³</th>
        <th>Lá»›p</th>
        <th>NgÃ y Ä‘Äƒng kÃ½</th>
        <th>HÃ nh Ä‘á»™ng</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of enrolledSubjects">
        <td>{{ s.subjectCode }}</td>
        <td>{{ s.subjectName }}</td>
        <td>{{ s.semesterName }}</td>
        <td>{{ s.classCode }}</td>
        <td>{{ s.enrollDate | date:'dd/MM/yyyy' }}</td>
        <td>
          <button class="btn btn-danger btn-sm"
                  (click)="cancelEnrollment(s.id)"
                  [disabled]="!isSemesterOpen()"
                  title="Há»§y Ä‘Äƒng kÃ½ mÃ´n há»c">
            Há»§y
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="enrolledSubjects.length === 0" class="alert alert-info">
    ChÆ°a cÃ³ mÃ´n há»c nÃ o Ä‘Æ°á»£c Ä‘Äƒng kÃ½.
  </div>
</div>
